% this is some sample data (voltage in col 1, current in col 2)
% it was the result of a forward model, e.g. sinh function
% analytic solution was hairy so trial and error method was used instead

a = [-2.500E+00, -1.132E+47
-2.490E+00, -7.691E+46
-2.480E+00, -5.223E+46
-2.470E+00, -3.548E+46
-2.460E+00, -2.410E+46
-2.450E+00, -1.637E+46
-2.440E+00, -1.112E+46
-2.430E+00, -7.550E+45
-2.420E+00, -5.128E+45
-2.410E+00, -3.483E+45
-2.400E+00, -2.365E+45
-2.390E+00, -1.607E+45
-2.380E+00, -1.091E+45
-2.370E+00, -7.411E+44
-2.360E+00, -5.034E+44
-2.350E+00, -3.419E+44
-2.340E+00, -2.322E+44
-2.330E+00, -1.577E+44
-2.320E+00, -1.071E+44
-2.310E+00, -7.275E+43
-2.300E+00, -4.941E+43
-2.290E+00, -3.356E+43
-2.280E+00, -2.280E+43
-2.270E+00, -1.548E+43
-2.260E+00, -1.052E+43
-2.250E+00, -7.142E+42
-2.240E+00, -4.851E+42
-2.230E+00, -3.295E+42
-2.220E+00, -2.238E+42
-2.210E+00, -1.520E+42
-2.200E+00, -1.032E+42
-2.190E+00, -7.011E+41
-2.180E+00, -4.762E+41
-2.170E+00, -3.234E+41
-2.160E+00, -2.197E+41
-2.150E+00, -1.492E+41
-2.140E+00, -1.013E+41
-2.130E+00, -6.883E+40
-2.120E+00, -4.675E+40
-2.110E+00, -3.175E+40
-2.100E+00, -2.156E+40
-2.090E+00, -1.465E+40
-2.080E+00, -9.948E+39
-2.070E+00, -6.757E+39
-2.060E+00, -4.589E+39
-2.050E+00, -3.117E+39
-2.040E+00, -2.117E+39
-2.030E+00, -1.438E+39
-2.020E+00, -9.766E+38
-2.010E+00, -6.633E+38
-2.000E+00, -4.505E+38
-1.990E+00, -3.060E+38
-1.980E+00, -2.078E+38
-1.970E+00, -1.411E+38
-1.960E+00, -9.587E+37
-1.950E+00, -6.511E+37
-1.940E+00, -4.422E+37
-1.930E+00, -3.004E+37
-1.920E+00, -2.040E+37
-1.910E+00, -1.386E+37
-1.900E+00, -9.411E+36
-1.890E+00, -6.392E+36
-1.880E+00, -4.341E+36
-1.870E+00, -2.949E+36
-1.860E+00, -2.003E+36
-1.850E+00, -1.360E+36
-1.840E+00, -9.238E+35
-1.830E+00, -6.275E+35
-1.820E+00, -4.262E+35
-1.810E+00, -2.895E+35
-1.800E+00, -1.966E+35
-1.790E+00, -1.335E+35
-1.780E+00, -9.069E+34
-1.770E+00, -6.160E+34
-1.760E+00, -4.184E+34
-1.750E+00, -2.842E+34
-1.740E+00, -1.930E+34
-1.730E+00, -1.311E+34
-1.720E+00, -8.903E+33
-1.710E+00, -6.047E+33
-1.700E+00, -4.107E+33
-1.690E+00, -2.789E+33
-1.680E+00, -1.895E+33
-1.670E+00, -1.287E+33
-1.660E+00, -8.740E+32
-1.650E+00, -5.936E+32
-1.640E+00, -4.032E+32
-1.630E+00, -2.738E+32
-1.620E+00, -1.860E+32
-1.610E+00, -1.263E+32
-1.600E+00, -8.580E+31
-1.590E+00, -5.827E+31
-1.580E+00, -3.958E+31
-1.570E+00, -2.688E+31
-1.560E+00, -1.826E+31
-1.550E+00, -1.240E+31
-1.540E+00, -8.422E+30
-1.530E+00, -5.720E+30
-1.520E+00, -3.885E+30
-1.510E+00, -2.639E+30
-1.500E+00, -1.792E+30
-1.490E+00, -1.217E+30
-1.480E+00, -8.268E+29
-1.470E+00, -5.616E+29
-1.460E+00, -3.814E+29
-1.450E+00, -2.590E+29
-1.440E+00, -1.759E+29
-1.430E+00, -1.195E+29
-1.420E+00, -8.116E+28
-1.410E+00, -5.513E+28
-1.400E+00, -3.744E+28
-1.390E+00, -2.543E+28
-1.380E+00, -1.727E+28
-1.370E+00, -1.173E+28
-1.360E+00, -7.968E+27
-1.350E+00, -5.412E+27
-1.340E+00, -3.676E+27
-1.330E+00, -2.496E+27
-1.320E+00, -1.696E+27
-1.310E+00, -1.152E+27
-1.300E+00, -7.822E+26
-1.290E+00, -5.312E+26
-1.280E+00, -3.608E+26
-1.270E+00, -2.451E+26
-1.260E+00, -1.664E+26
-1.250E+00, -1.130E+26
-1.240E+00, -7.678E+25
-1.230E+00, -5.215E+25
-1.220E+00, -3.542E+25
-1.210E+00, -2.406E+25
-1.200E+00, -1.634E+25
-1.190E+00, -1.110E+25
-1.180E+00, -7.538E+24
-1.170E+00, -5.119E+24
-1.160E+00, -3.477E+24
-1.150E+00, -2.362E+24
-1.140E+00, -1.604E+24
-1.130E+00, -1.089E+24
-1.120E+00, -7.399E+23
-1.110E+00, -5.026E+23
-1.100E+00, -3.413E+23
-1.090E+00, -2.318E+23
-1.080E+00, -1.575E+23
-1.070E+00, -1.069E+23
-1.060E+00, -7.264E+22
-1.050E+00, -4.934E+22
-1.040E+00, -3.351E+22
-1.030E+00, -2.276E+22
-1.020E+00, -1.546E+22
-1.010E+00, -1.050E+22
-1.000E+00, -7.131E+21
-9.900E-01, -4.843E+21
-9.800E-01, -3.289E+21
-9.700E-01, -2.234E+21
-9.600E-01, -1.517E+21
-9.500E-01, -1.031E+21
-9.400E-01, -7.000E+20
-9.300E-01, -4.754E+20
-9.200E-01, -3.229E+20
-9.100E-01, -2.193E+20
-9.000E-01, -1.490E+20
-8.900E-01, -1.012E+20
-8.800E-01, -6.872E+19
-8.700E-01, -4.667E+19
-8.600E-01, -3.170E+19
-8.500E-01, -2.153E+19
-8.400E-01, -1.462E+19
-8.300E-01, -9.932E+18
-8.200E-01, -6.746E+18
-8.100E-01, -4.582E+18
-8.000E-01, -3.112E+18
-7.900E-01, -2.114E+18
-7.800E-01, -1.436E+18
-7.700E-01, -9.750E+17
-7.600E-01, -6.622E+17
-7.500E-01, -4.498E+17
-7.400E-01, -3.055E+17
-7.300E-01, -2.075E+17
-7.200E-01, -1.409E+17
-7.100E-01, -9.571E+16
-7.000E-01, -6.501E+16
-6.900E-01, -4.415E+16
-6.800E-01, -2.999E+16
-6.700E-01, -2.037E+16
-6.600E-01, -1.383E+16
-6.500E-01, -9.396E+15
-6.400E-01, -6.382E+15
-6.300E-01, -4.334E+15
-6.200E-01, -2.944E+15
-6.100E-01, -1.999E+15
-6.000E-01, -1.358E+15
-5.900E-01, -9.224E+14
-5.800E-01, -6.265E+14
-5.700E-01, -4.255E+14
-5.600E-01, -2.890E+14
-5.500E-01, -1.963E+14
-5.400E-01, -1.333E+14
-5.300E-01, -9.055E+13
-5.200E-01, -6.150E+13
-5.100E-01, -4.177E+13
-5.000E-01, -2.837E+13
-4.900E-01, -1.927E+13
-4.800E-01, -1.309E+13
-4.700E-01, -8.889E+12
-4.600E-01, -6.037E+12
-4.500E-01, -4.100E+12
-4.400E-01, -2.785E+12
-4.300E-01, -1.892E+12
-4.200E-01, -1.285E+12
-4.100E-01, -8.726E+11
-4.000E-01, -5.926E+11
-3.900E-01, -4.025E+11
-3.800E-01, -2.734E+11
-3.700E-01, -1.857E+11
-3.600E-01, -1.261E+11
-3.500E-01, -8.566E+10
-3.400E-01, -5.818E+10
-3.300E-01, -3.951E+10
-3.200E-01, -2.684E+10
-3.100E-01, -1.823E+10
-3.000E-01, -1.238E+10
-2.900E-01, -8.409E+09
-2.800E-01, -5.711E+09
-2.700E-01, -3.879E+09
-2.600E-01, -2.635E+09
-2.500E-01, -1.789E+09
-2.400E-01, -1.215E+09
-2.300E-01, -8.255E+08
-2.200E-01, -5.607E+08
-2.100E-01, -3.808E+08
-2.000E-01, -2.586E+08
-1.900E-01, -1.757E+08
-1.800E-01, -1.193E+08
-1.700E-01, -8.103E+07
-1.600E-01, -5.504E+07
-1.500E-01, -3.738E+07
-1.400E-01, -2.539E+07
-1.300E-01, -1.724E+07
-1.200E-01, -1.171E+07
-1.100E-01, -7.955E+06
-1.000E-01, -5.403E+06
-9.000E-02, -3.670E+06
-8.000E-02, -2.492E+06
-7.000E-02, -1.693E+06
-6.000E-02, -1.150E+06
-5.000E-02, -7.809E+05
-4.000E-02, -5.304E+05
-3.000E-02, -3.602E+05
-2.000E-02, -2.447E+05
-1.000E-02, -1.662E+05
-5.329E-14, -1.129E+05
1.000E-02, -7.666E+04
2.000E-02, -5.207E+04
3.000E-02, -3.536E+04
4.000E-02, -2.402E+04
5.000E-02, -1.631E+04
6.000E-02, -1.108E+04
7.000E-02, -7.525E+03
8.000E-02, -5.111E+03
9.000E-02, -3.472E+03
1.000E-01, -2.358E+03
1.100E-01, -1.601E+03
1.200E-01, -1.088E+03
1.300E-01, -7.387E+02
1.400E-01, -5.018E+02
1.500E-01, -3.408E+02
1.600E-01, -2.315E+02
1.700E-01, -1.572E+02
1.800E-01, -1.068E+02
1.900E-01, -7.252E+01
2.000E-01, -4.926E+01
2.100E-01, -3.345E+01
2.200E-01, -2.272E+01
2.300E-01, -1.543E+01
2.400E-01, -1.048E+01
2.500E-01, -7.119E+00
2.600E-01, -4.835E+00
2.700E-01, -3.284E+00
2.800E-01, -2.231E+00
2.900E-01, -1.515E+00
3.000E-01, -1.029E+00
3.100E-01, -6.989E-01
3.200E-01, -4.747E-01
3.300E-01, -3.224E-01
3.400E-01, -2.190E-01
3.500E-01, -1.487E-01
3.600E-01, -1.010E-01
3.700E-01, -6.861E-02
3.800E-01, -4.660E-02
3.900E-01, -3.165E-02
4.000E-01, -2.150E-02
4.100E-01, -1.460E-02
4.200E-01, -9.916E-03
4.300E-01, -6.735E-03
4.400E-01, -4.574E-03
4.500E-01, -3.107E-03
4.600E-01, -2.110E-03
4.700E-01, -1.433E-03
4.800E-01, -9.734E-04
4.900E-01, -6.611E-04
5.000E-01, -4.490E-04
5.100E-01, -3.050E-04
5.200E-01, -2.071E-04
5.300E-01, -1.407E-04
5.400E-01, -9.556E-05
5.500E-01, -6.490E-05
5.600E-01, -4.408E-05
5.700E-01, -2.994E-05
5.800E-01, -2.033E-05
5.900E-01, -1.381E-05
6.000E-01, -9.381E-06
6.100E-01, -6.371E-06
6.200E-01, -4.327E-06
6.300E-01, -2.939E-06
6.400E-01, -1.996E-06
6.500E-01, -1.356E-06
6.600E-01, -9.209E-07
6.700E-01, -6.255E-07
6.800E-01, -4.248E-07
6.900E-01, -2.885E-07
7.000E-01, -1.960E-07
7.100E-01, -1.331E-07
7.200E-01, -9.040E-08
7.300E-01, -6.140E-08
7.400E-01, -4.170E-08
7.500E-01, -2.832E-08
7.600E-01, -1.924E-08
7.700E-01, -1.307E-08
7.800E-01, -8.874E-09
7.900E-01, -6.027E-09
8.000E-01, -4.094E-09
8.100E-01, -2.780E-09
8.200E-01, -1.888E-09
8.300E-01, -1.283E-09
8.400E-01, -8.712E-10
8.500E-01, -5.917E-10
8.600E-01, -4.019E-10
8.700E-01, -2.729E-10
8.800E-01, -1.854E-10
8.900E-01, -1.259E-10
9.000E-01, -8.552E-11
9.100E-01, -5.808E-11
9.200E-01, -3.945E-11
9.300E-01, -2.679E-11
9.400E-01, -1.820E-11
9.500E-01, -1.236E-11
9.600E-01, -8.395E-12
9.700E-01, -5.702E-12
9.800E-01, -3.873E-12
9.900E-01, -2.630E-12
1.000E+00, -1.787E-12
1.010E+00, -1.213E-12
1.020E+00, -8.241E-13
1.030E+00, -5.597E-13
1.040E+00, -3.802E-13
1.050E+00, -2.582E-13
1.060E+00, -1.754E-13
1.070E+00, -1.191E-13
1.080E+00, -8.090E-14
1.090E+00, -5.495E-14
1.100E+00, -3.732E-14
1.110E+00, -2.535E-14
1.120E+00, -1.722E-14
1.130E+00, -1.169E-14
1.140E+00, -7.942E-15
1.150E+00, -5.394E-15
1.160E+00, -3.663E-15
1.170E+00, -2.488E-15
1.180E+00, -1.690E-15
1.190E+00, -1.147E-15
1.200E+00, -7.786E-16
1.210E+00, -5.279E-16
1.220E+00, -3.573E-16
1.230E+00, -2.408E-16
1.240E+00, -1.608E-16
1.250E+00, -1.052E-16
1.260E+00, -6.547E-17
1.270E+00, -3.570E-17
1.280E+00, -1.133E-17
1.290E+00, 1.133E-17
1.300E+00, 3.570E-17
1.310E+00, 6.547E-17
1.320E+00, 1.052E-16
1.330E+00, 1.608E-16
1.340E+00, 2.408E-16
1.350E+00, 3.573E-16
1.360E+00, 5.279E-16
1.370E+00, 7.786E-16
1.380E+00, 1.147E-15
1.390E+00, 1.690E-15
1.400E+00, 2.488E-15
1.410E+00, 3.663E-15
1.420E+00, 5.394E-15
1.430E+00, 7.942E-15
1.440E+00, 1.169E-14
1.450E+00, 1.722E-14
1.460E+00, 2.535E-14
1.470E+00, 3.732E-14
1.480E+00, 5.495E-14
1.490E+00, 8.090E-14
1.500E+00, 1.191E-13
1.510E+00, 1.754E-13
1.520E+00, 2.582E-13
1.530E+00, 3.802E-13
1.540E+00, 5.597E-13
1.550E+00, 8.241E-13
1.560E+00, 1.213E-12
1.570E+00, 1.787E-12
1.580E+00, 2.630E-12
1.590E+00, 3.873E-12
1.600E+00, 5.702E-12
1.610E+00, 8.395E-12
1.620E+00, 1.236E-11
1.630E+00, 1.820E-11
1.640E+00, 2.679E-11
1.650E+00, 3.945E-11
1.660E+00, 5.808E-11
1.670E+00, 8.552E-11
1.680E+00, 1.259E-10
1.690E+00, 1.854E-10
1.700E+00, 2.729E-10
1.710E+00, 4.019E-10
1.720E+00, 5.917E-10
1.730E+00, 8.712E-10
1.740E+00, 1.283E-09
1.750E+00, 1.888E-09
1.760E+00, 2.780E-09
1.770E+00, 4.094E-09
1.780E+00, 6.027E-09
1.790E+00, 8.874E-09
1.800E+00, 1.307E-08
1.810E+00, 1.924E-08
1.820E+00, 2.832E-08
1.830E+00, 4.170E-08
1.840E+00, 6.140E-08
1.850E+00, 9.040E-08
1.860E+00, 1.331E-07
1.870E+00, 1.960E-07
1.880E+00, 2.885E-07
1.890E+00, 4.248E-07
1.900E+00, 6.255E-07
1.910E+00, 9.209E-07
1.920E+00, 1.356E-06
1.930E+00, 1.996E-06
1.940E+00, 2.939E-06
1.950E+00, 4.327E-06
1.960E+00, 6.371E-06
1.970E+00, 9.381E-06
1.980E+00, 1.381E-05
1.990E+00, 2.033E-05
2.000E+00, 2.994E-05
2.010E+00, 4.408E-05
2.020E+00, 6.490E-05
2.030E+00, 9.556E-05
2.040E+00, 1.407E-04
2.050E+00, 2.071E-04
2.060E+00, 3.050E-04
2.070E+00, 4.490E-04
2.080E+00, 6.611E-04
2.090E+00, 9.734E-04
2.100E+00, 1.433E-03
2.110E+00, 2.110E-03
2.120E+00, 3.107E-03
2.130E+00, 4.574E-03
2.140E+00, 6.735E-03
2.150E+00, 9.916E-03
2.160E+00, 1.460E-02
2.170E+00, 2.150E-02
2.180E+00, 3.165E-02
2.190E+00, 4.660E-02
2.200E+00, 6.861E-02
2.210E+00, 1.010E-01
2.220E+00, 1.487E-01
2.230E+00, 2.190E-01
2.240E+00, 3.224E-01
2.250E+00, 4.747E-01
2.260E+00, 6.989E-01
2.270E+00, 1.029E+00
2.280E+00, 1.515E+00
2.290E+00, 2.231E+00
2.300E+00, 3.284E+00
2.310E+00, 4.835E+00
2.320E+00, 7.119E+00
2.330E+00, 1.048E+01
2.340E+00, 1.543E+01
2.350E+00, 2.272E+01
2.360E+00, 3.345E+01
2.370E+00, 4.926E+01
2.380E+00, 7.252E+01
2.390E+00, 1.068E+02
2.400E+00, 1.572E+02
2.410E+00, 2.315E+02
2.420E+00, 3.408E+02
2.430E+00, 5.018E+02
2.440E+00, 7.387E+02
2.450E+00, 1.088E+03
2.460E+00, 1.601E+03
2.470E+00, 2.358E+03
2.480E+00, 3.472E+03
2.490E+00, 5.111E+03 ];

idx = abs(a(:,2)) < 1e-5;
d = a(idx, :);

x = a(idx,1);
y = a(idx,2);

center = 1.29;

%%

% minimum value (center of sinh function)
find(abs(a(:,2)) == min(abs(a(:,2))))

%%

a = y(1) / sinh(x(1)-1.285);
b = 5;

f = a * sinh(b * (x-1.285));

err = sum((f - y) .^ 2) / 2;

lr = 0.01;

while err > 0
% for i=1:10
    f = a * sinh(b * (x-1.285));
    
    grad_a = sum((f - y) .* sinh(b * (x-1.285)));
    grad_b = sum((f - y) .* cosh(b * (x-1.285)) .* (x-1.285));

    a = a - lr * grad_a / numel(x);
    b = b - lr * grad_b / numel(x);
    
%     lr = lr * 0.99999;
    
    err = sum((f - y) .^ 2) / 2;
    disp(err);
end

%%

plot(f); hold on; plot(y);

ap = a;
bp = b;

for i=1:1
    ap = ap / 4000000000;
    bp = bp * 7.83;
    fp = ap * sinh(bp * (x-1.285));
    plot(fp);
end
